<script>
  // Variables
  var clientId = 'd3859a90-3d1e-44bf-8925-eb14935442c8';
  var clientApp = 'Masa';
  var clientName = 'Masa';
  var pageUrl = window.location.href;

  (function(i, s, o, g, r, a, m) {
    i['MasaAnalytics'] = i['MasaAnalytics'] || function() {
      (i['MasaAnalytics'].q = i['MasaAnalytics'].q || []).push(arguments)
    };
    i['MasaAnalytics'].clientId = clientId;
    a = s.createElement(o);
    m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;

    // Add an event listener to ensure the script is loaded before calling its functions
    a.onload = function() {
      // Track page view event for initial load
      MasaAnalytics.trackPageView(clientId, clientApp, clientName, pageUrl);

      // This function is called every time a "page view" happens in SPAs, i.e., when the route changes
      function trackPageViewForSPA() {
        var updatedPageUrl = window.location.href;
        MasaAnalytics.trackPageView(clientId, clientApp, clientName, updatedPageUrl);
      }

      // This event is triggered when the route changes in many SPAs
      window.addEventListener('popstate', trackPageViewForSPA);
    };

    m.parentNode.insertBefore(a, m);
  })(window, document, 'script', 'https://cdn.masa.finance/masa-analytics.js');
</script>
